// Generated by CoffeeScript 1.6.3
(function() {
  var admin_index;

  this.admin_index = admin_index = (function() {
    function admin_index() {}

    admin_index.prototype.run = function() {
      var _this = this;
      $("#accordion").accordion({
        collapsible: true
      });
      $("button").button();
      $("#dialog-succ, #dialog-fail").dialog({
        autoOpen: false,
        modal: true,
        closeOnEscape: true,
        show: {
          effect: "blind",
          duration: 500
        },
        hide: {
          effect: "explode",
          duration: 1500
        }
      });
      $("#btn-clearDB").click(function() {
        return $.post('/admin/clearDB').done(function(data) {
          return _this.__showSucc();
        }).fail(function(data) {
          return _this.__showFail();
        });
      });
      $("#btn-autoGenNames").click(function() {
        return $.post('/admin/autoGenNames', {
          secondWordString: $("#secondWordString").val(),
          thirdWordString: $("#thirdWordString").val()
        }).done(function(data) {
          return _this.__showSucc();
        }).fail(function(data) {
          return _this.__showFail();
        });
      });
      $("#btn-batchAddNames").click(function() {
        return $.post('/admin/batchAddNames', {
          names: $("#batch-names").val()
        }).done(function(data) {
          return _this.__showSucc();
        }).fail(function(data) {
          return _this.__showFail();
        });
      });
      $("#btn-previewNamesTobeDel").click(function() {
        return $.post('/admin/queryFilteredNames', {
          filters: $("#name-deletion-filters").val()
        }).done(function(data) {
          return _this.__listNames(data);
        }).fail(function(data) {
          _this.__clearNames();
          return _this.__showFail();
        });
      });
      return $("#btn-delPreviewedNames").click(function() {
        return $.post('/admin/delPreviewedNames', {
          filters: $("#name-deletion-filters").val()
        }).done(function(data) {
          return _this.__showSucc();
        }).fail(function(data) {
          return _this.__showFail();
        });
      });
    };

    admin_index.prototype.__showSucc = function() {
      return $("#dialog-succ").dialog("open");
    };

    admin_index.prototype.__showFail = function() {
      return $("#dialog-fail").dialog("open");
    };

    admin_index.prototype.__clearNames = function() {
      return $("#filtered-name-list").children().remove();
    };

    admin_index.prototype.__listNames = function(names) {
      var nameCandidate, nameCandidateElement, nameList, _i, _len,
        _this = this;
      nameList = $("#filtered-name-list");
      this.__clearNames();
      for (_i = 0, _len = names.length; _i < _len; _i++) {
        nameCandidate = names[_i];
        nameCandidateElement = $("<div>").attr("data-id", nameCandidate._id).appendTo(nameList);
        $("<span>").text(nameCandidate.name).appendTo(nameCandidateElement);
        $("<button>").addClass("name-candidate-pending").text("删除").appendTo(nameCandidateElement);
      }
      return new window.NameCandidateGroup(nameList).render().actionButtonClick(function(event, nameCandidate) {
        var id;
        id = nameCandidate.jQueryObj().data("id");
        return $.post('/admin/delAName', {
          id: id
        }).done(function(data) {
          return nameCandidate.removeFromGroup(function() {
            return _this.__showSucc();
          });
        }).fail(function(data) {
          return _this.__showFail();
        });
      });
    };

    return admin_index;

  })();

}).call(this);
